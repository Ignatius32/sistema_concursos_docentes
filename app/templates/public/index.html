{% extends "base.html" %}

{% block title %}Concursos Docentes - Portal Público{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/tribunal.css') }}?v=2.0">
<style>
.public-hero {
    background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
    color: white;
    border-radius: 20px;
    padding: 3rem 2rem;
    margin-bottom: 2rem;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.public-hero h1 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
}

.public-hero p {
    font-size: 1.1rem;
    opacity: 0.9;
    margin-bottom: 0;
}

.search-container {
    background: white;
    border-radius: 15px;
    padding: 2rem;
    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
    margin-bottom: 2rem;
}

.concurso-card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    transition: all 0.3s ease;
    margin-bottom: 1.5rem;
    overflow: hidden;
}

.concurso-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.concurso-card .card-header {
    background: #2563eb;
    color: white;
    border: none;
    padding: 1.5rem;
}

.concurso-card .card-body {
    padding: 1.5rem;
}

.status-badge {
    font-size: 0.9rem;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-abierto {
    background: #059669;
    color: white;
}

.status-cerrado {
    background: #d97706;
    color: white;
}

.filter-btn {
    background: #2563eb;
    border: none;
    color: white;
    padding: 0.75rem 2rem;
    border-radius: 25px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.filter-btn:hover {
    background: #1d4ed8;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(37, 99, 235, 0.4);
    color: white;
}

.clear-btn {
    background: transparent;
    border: 2px solid #6b7280;
    color: #6b7280;
    padding: 0.75rem 2rem;
    border-radius: 25px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.clear-btn:hover {
    background: #6b7280;
    color: white;
}

.info-tag {
    background: #eff6ff;
    color: #1e40af;
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.85rem;
    font-weight: 500;
    display: inline-block;
    margin: 0.25rem;
}

.no-results {
    text-align: center;
    padding: 3rem;
    color: #6b7280;
}

.no-results i {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

/* Mobile responsive hero section */
@media (max-width: 768px) {
    .hero-content {
        flex-direction: column !important;
        text-align: center;
    }
    
    .hero-content img {
        margin-right: 0 !important;
        margin-bottom: 1rem;
    }
    
    .hero-content h1 {
        font-size: 2rem;
    }
}
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="public-hero">
    <div class="d-flex align-items-center justify-content-center mb-3 hero-content">
        <img src="{{ url_for('static', filename='img/logo3.png') }}" alt="Logo Universidad" style="height: 5rem; margin-right: 1.5rem;">
        <h1 class="mb-0">Selecciones de Personal Docente</h1>
    </div>
    <p>Centro Regional Universitario Bariloche de la Universidad Nacional del Comahue</p>
</div>

<!-- Search Section -->
<div class="search-container">
    <form method="GET" action="{{ url_for('public.index') }}" id="filterForm">
        <div class="row g-3 align-items-end">
            <div class="col-md-5">
                <label for="departamento" class="form-label fw-semibold">
                    <i class="bi bi-building me-1"></i>Departamento
                </label>
                <select name="departamento" id="departamento" class="form-select form-select-lg">
                    <option value="">Todos los departamentos</option>
                    {% for depto in departamentos %}
                    <option value="{{ depto.id }}" {% if departamento_filter == depto.id|string %}selected{% endif %}>
                        {{ depto.nombre }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label for="estado" class="form-label fw-semibold">
                    <i class="bi bi-circle-fill me-1"></i>Estado
                </label>
                <select name="estado" id="estado" class="form-select form-select-lg">
                    <option value="">Todos</option>
                    {% for estado in estados_disponibles %}
                    <option value="{{ estado }}" {% if estado_filter == estado %}selected{% endif %}>
                        {{ estado }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <div class="d-flex gap-2">
                    <button type="submit" class="btn filter-btn flex-fill">
                        <i class="bi bi-search me-2"></i>Buscar
                    </button>
                    <button type="button" class="btn clear-btn" onclick="clearFilters()">
                        <i class="bi bi-arrow-clockwise me-2"></i>Limpiar
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Active Filters Display -->
        {% if departamento_filter or estado_filter %}
        <div class="mt-3">
            <div class="d-flex align-items-center flex-wrap gap-2">
                <span class="text-muted">Filtros activos:</span>
                {% if departamento_filter %}
                    {% for depto in departamentos %}
                        {% if depto.id|string == departamento_filter %}
                        <span class="info-tag">
                            <i class="bi bi-building me-1"></i>{{ depto.nombre }}
                            <button type="button" class="btn-close btn-close-sm ms-1" onclick="removeFilter('departamento')"></button>
                        </span>
                        {% endif %}
                    {% endfor %}
                {% endif %}
                {% if estado_filter %}
                <span class="info-tag">
                    <i class="bi bi-circle-fill me-1"></i>{{ estado_filter }}
                    <button type="button" class="btn-close btn-close-sm ms-1" onclick="removeFilter('estado')"></button>
                </span>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </form>
</div>

<!-- Results Section -->
{% if concursos %}
<div class="mb-3">
    <div class="alert alert-info border-0" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); color: #1565c0;">
        <div class="d-flex align-items-center">
            <i class="bi bi-info-circle-fill me-2"></i>
            <span>
                <strong>{{ concursos|length }}</strong> concurso(s) encontrado(s)
                {% if departamento_filter or estado_filter %}
                    con los filtros aplicados
                {% endif %}
            </span>
        </div>
    </div>
</div>

<!-- Concursos Cards -->
<div class="row">
    {% for concurso in concursos %}
    <div class="col-12 col-lg-6 mb-4">
        <div class="concurso-card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h5 class="mb-1 fw-bold">
                            <i class="bi bi-building me-2"></i>{{ concurso.departamento_rel.nombre if concurso.departamento_rel else 'N/A' }}
                        </h5>
                        <p class="mb-0 opacity-90">
                            <i class="bi bi-compass me-1"></i>{{ concurso.area }}
                        </p>
                    </div>
                    <span class="status-badge status-{{ 'abierto' if concurso.estado_actual == 'ABIERTO' else 'cerrado' }}">
                        {{ concurso.estado_actual }}
                    </span>
                </div>
            </div>
            <div class="card-body">
                <div class="row g-3 mb-3">
                    <div class="col-6">
                        <div class="d-flex align-items-center text-muted mb-1">
                            <i class="bi bi-award me-1"></i>
                            <small>Categoría</small>
                        </div>
                        <span class="fw-semibold">{{ concurso.categoria_nombre }}</span>
                    </div>
                    <div class="col-6">
                        <div class="d-flex align-items-center text-muted mb-1">
                            <i class="bi bi-clock me-1"></i>
                            <small>Dedicación</small>
                        </div>
                        <span class="fw-semibold">{{ concurso.dedicacion }}</span>
                    </div>
                </div>
                
                {% if concurso.cierre_inscripcion %}
                <div class="mb-3">
                    <div class="d-flex align-items-center text-muted mb-1">
                        <i class="bi bi-calendar-x me-1"></i>
                        <small>Cierre de inscripciones</small>
                    </div>
                    <span class="fw-semibold text-danger">{{ concurso.cierre_inscripcion.strftime('%d de %B de %Y') }}</span>
                </div>
                {% endif %}
                
                <div class="d-grid">
                    <a href="{{ url_for('public.ver_concurso', concurso_id=concurso.id) }}" 
                       class="btn filter-btn">
                        <i class="bi bi-eye me-2"></i>Ver Detalles Completos
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<!-- No Results State -->
<div class="no-results">
    <i class="bi bi-search"></i>
    <h4>No se encontraron concursos</h4>
    <p>
        {% if departamento_filter or estado_filter %}
            No hay concursos que coincidan con los filtros seleccionados.
            <br>Intenta modificar los criterios de búsqueda.
        {% else %}
            Actualmente no hay concursos docentes disponibles.
        {% endif %}
    </p>    {% if departamento_filter or estado_filter %}
    <button type="button" class="btn clear-btn btn-lg" onclick="clearFilters()">
        <i class="bi bi-arrow-clockwise me-2"></i>Limpiar Filtros
    </button>
    {% endif %}
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-submit form when filters change
    const filterForm = document.getElementById('filterForm');
    const selects = filterForm.querySelectorAll('select');
    
    selects.forEach(select => {
        select.addEventListener('change', function() {
            // Add a small delay to show the change visually
            this.style.opacity = '0.7';
            setTimeout(() => {
                filterForm.submit();
            }, 200);
        });
    });
    
    // Mobile filter collapse behavior
    const filterToggle = document.querySelector('[data-bs-toggle="collapse"]');
    const filterSection = document.getElementById('filterSection');
    
    if (filterToggle && filterSection) {
        filterSection.addEventListener('show.bs.collapse', function() {
            filterToggle.innerHTML = '<i class="bi bi-chevron-up"></i>';
        });
        
        filterSection.addEventListener('hide.bs.collapse', function() {
            filterToggle.innerHTML = '<i class="bi bi-chevron-down"></i>';
        });
    }
});

function clearFilters() {
    window.location.href = "{{ url_for('public.index') }}";
}

function removeFilter(filterName) {
    const form = document.getElementById('filterForm');
    const input = form.querySelector(`[name="${filterName}"]`);
    if (input) {
        input.value = '';
        form.submit();
    }
}

// Add loading state to buttons
document.addEventListener('submit', function(e) {
    if (e.target.id === 'filterForm') {
        const submitBtn = e.target.querySelector('button[type="submit"]');
        if (submitBtn) {
            submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Buscando...';
            submitBtn.disabled = true;
        }
    }
});

// Add smooth hover effects
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.tribunal-card');
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
            this.style.transition = 'transform 0.2s ease';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
});
</script>
{% endblock %}
