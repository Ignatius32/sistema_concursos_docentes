<!-- filepath: c:\Users\diraa\Documents\sistema_concursos_docentes\app\templates\tribunal\portal_concurso.html -->
{% extends "base.html" %}

{% block title %}Concurso #{{ concurso.id }} - Portal del Tribunal - {{ super() }}{% endblock %}

{% block content %}
<div class="mb-4">
    <!-- Breadcrumb navigation -->
    <nav aria-label="breadcrumb" class="mb-3 tribunal-breadcrumb">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item">
                <a href="{{ url_for('tribunal.portal') }}">
                    <i class="bi bi-house"></i> Portal del Tribunal
                </a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">Concurso #{{ concurso.id }}</li>
        </ol>
    </nav>
</div>

<!-- Tabs Navigation -->
<ul class="nav nav-tabs tribunal-tabs mb-4" id="concursoTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" 
                type="button" role="tab" aria-controls="general" aria-selected="true">
            <i class="bi bi-info-circle"></i> General
        </button>
    </li>
    {% if concurso.sustanciacion %}
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="sustanciacion-tab" data-bs-toggle="tab" data-bs-target="#sustanciacion" 
                type="button" role="tab" aria-controls="sustanciacion" aria-selected="false">
            <i class="bi bi-calendar-event"></i> Sustanciación
        </button>
    </li>
    {% endif %}
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="documentos-tab" data-bs-toggle="tab" data-bs-target="#documentos" 
                type="button" role="tab" aria-controls="documentos" aria-selected="false">
            <i class="bi bi-file-earmark-text"></i> Documentos
        </button>
    </li>    <li class="nav-item" role="presentation">
        <button class="nav-link" id="postulantes-tab" data-bs-toggle="tab" data-bs-target="#postulantes" 
                type="button" role="tab" aria-controls="postulantes" aria-selected="false">
            <i class="bi bi-person-check"></i> Postulantes
        </button>
    </li>
    {% if concurso.sustanciacion and concurso.sustanciacion.temas_exposicion or miembro.can_add_tema %}
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="temas-tab" data-bs-toggle="tab" data-bs-target="#temas" 
                type="button" role="tab" aria-controls="temas" aria-selected="false">
            <i class="bi bi-list-task"></i> Temas de Sorteo
        </button>
    </li>
    {% endif %}
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="asignaturas-tab" data-bs-toggle="tab" data-bs-target="#asignaturas" 
                type="button" role="tab" aria-controls="asignaturas" aria-selected="false">
            <i class="bi bi-book"></i> Asignaturas Relacionadas
        </button>
    </li>
</ul>

<!-- Tabs Content -->
<div class="tab-content tribunal-tab-content" id="concursoTabsContent">    <!-- General Tab -->
    <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
        <!-- Concurso Information Section -->
        <div class="row">
            <div class="col-md-8">                <div class="card">
                    <div class="card-header header-primary">
                        <h4 class="mb-0"><i class="bi bi-info-circle"></i> Información del Concurso</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Departamento:</strong> {{ concurso.departamento_rel.nombre }}</p>
                                <p><strong>Área:</strong> {{ concurso.area }}</p>
                                <p><strong>Orientación:</strong> {{ concurso.orientacion }}</p>
                                <p><strong>Tipo:</strong> {{ concurso.tipo }}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Categoría:</strong> {{ concurso.categoria_nombre }} ({{ concurso.categoria }})</p>
                                <p><strong>Dedicación:</strong> {{ concurso.dedicacion }}</p>
                                <p><strong>Cantidad de Cargos:</strong> {{ concurso.cant_cargos }}</p>
                                <p><strong>Estado:</strong> 
                                    <span class="badge badge-tribunal-{{ 'success' if concurso.estado_actual == 'activo' else 'secondary' }}"
                                          style="background-color: {{ '#059669' if concurso.estado_actual == 'activo' else '#6b7280' }} !important; color: white !important;">
                                        {{ concurso.estado_actual | upper }}
                                    </span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">                <div class="card">
                    <div class="card-header header-primary">
                        <h4 class="mb-0"><i class="bi bi-people"></i> Miembros del Tribunal</h4>
                    </div>
                    <div class="card-body">
                        {% include 'tribunal/partials/_tribunal_members.html' %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Instructivo Section -->
        {% if instructivo_tribunal %}
        <div class="row mt-4">
            <div class="col-12">                <div class="card">
                    <div class="card-header header-primary">
                        <h4 class="mb-0"><i class="bi bi-info-circle-fill"></i> Instructivo para el Tribunal</h4>
                    </div>
                    <div class="card-body">
                        {% if instructivo_tribunal.base %}
                        <div class="mb-3">
                            <h6><i class="bi bi-check2-circle"></i> Criterios Generales de Evaluación</h6>
                            <p class="text-muted">{{ instructivo_tribunal.base }}</p>
                        </div>
                        {% endif %}
                        
                        {% if instructivo_tribunal.dedicacion %}
                        <div>
                            <h6><i class="bi bi-star"></i> Criterios Específicos para {{ concurso.dedicacion }}</h6>
                            <p class="text-muted">{{ instructivo_tribunal.dedicacion }}</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    <!-- Sustanciación Tab -->
    {% if concurso.sustanciacion %}
    <div class="tab-pane fade" id="sustanciacion" role="tabpanel" aria-labelledby="sustanciacion-tab">        <div class="card">
            <div class="card-header header-primary">
                <h4 class="mb-0">Información de Sustanciación</h4>
            </div>
            <div class="card-body">
                {% include 'tribunal/partials/_sustanciacion_info.html' %}
            </div>
        </div>
    </div>
    {% endif %}    <!-- Documentos Tab -->
    <div class="tab-pane fade" id="documentos" role="tabpanel" aria-labelledby="documentos-tab">        <div class="card">
            <div class="card-header header-primary">
                <h4 class="mb-0">Documentos del Concurso</h4>
            </div>
            <div class="card-body">
                {% include 'tribunal/partials/_documentos_table.html' %}
            </div>
        </div>
    </div>    <!-- Postulantes Tab -->
    <div class="tab-pane fade" id="postulantes" role="tabpanel" aria-labelledby="postulantes-tab">        <div class="card">
            <div class="card-header header-primary">
                <h4 class="mb-0">Postulantes Inscriptos</h4>
            </div>
            <div class="card-body">
                {% include 'tribunal/partials/_postulantes_list.html' %}
            </div>
        </div>
    </div><!-- Temas de Sorteo Tab -->
    {% if concurso.sustanciacion and concurso.sustanciacion.temas_exposicion or miembro.can_add_tema %}
    <div class="tab-pane fade" id="temas" role="tabpanel" aria-labelledby="temas-tab">        <div class="card">
            <div class="card-header header-primary">
                <h4 class="mb-0">Temas de Sorteo</h4>
            </div>
            <div class="card-body">
                {% include 'tribunal/partials/_temas_sorteo.html' %}
            </div>
        </div>
    </div>
    {% endif %}    <!-- Asignaturas Tab -->
    <div class="tab-pane fade" id="asignaturas" role="tabpanel" aria-labelledby="asignaturas-tab">        <div class="card">
            <div class="card-header header-primary">
                <h4 class="mb-0">Asignaturas Relacionadas</h4>
            </div>
            <div class="card-body">
                {% include 'tribunal/partials/_asignaturas_info.html' %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/tribunal.css') }}?v=2.0">
<style>
/* Additional inline styles to ensure badge colors work */
.badge-tribunal-primary { background-color: #2563eb !important; color: white !important; }
.badge-tribunal-secondary { background-color: #6b7280 !important; color: white !important; }
.badge-tribunal-accent { background-color: #0891b2 !important; color: white !important; }
.badge-tribunal-success { background-color: #059669 !important; color: white !important; }
.badge-tribunal-warning { background-color: #d97706 !important; color: white !important; }
.badge-tribunal-info { background-color: #0891b2 !important; color: white !important; }
</style>
{% endblock %}

{% block scripts %}
<script>
function startFirmaLoading(documentoId) {
    // Hide info and show loading
    document.getElementById('firmaInfo' + documentoId).style.display = 'none';
    document.getElementById('firmaLoading' + documentoId).style.display = 'block';
    
    // Disable submit button
    document.getElementById('firmaButton' + documentoId).disabled = true;
    
    // Return true to allow form submission
    return true;
}

// Tab persistence and enhancement
document.addEventListener('DOMContentLoaded', function() {
    // Store the active tab in localStorage
    const tabTriggerList = [].slice.call(document.querySelectorAll('#concursoTabs button[data-bs-toggle="tab"]'));
    
    // Restore active tab from localStorage
    const savedTab = localStorage.getItem('portal-concurso-active-tab');
    if (savedTab) {
        const savedTabElement = document.querySelector(`button[data-bs-target="${savedTab}"]`);
        if (savedTabElement) {
            const tab = new bootstrap.Tab(savedTabElement);
            tab.show();
        }
    }
    
    // Save active tab to localStorage when tab changes
    tabTriggerList.forEach(function(tabTrigger) {
        tabTrigger.addEventListener('shown.bs.tab', function(event) {
            localStorage.setItem('portal-concurso-active-tab', event.target.getAttribute('data-bs-target'));
        });
    });
    
    // Add notification badges to tabs if there are important items
    updateTabNotifications();
});

function updateTabNotifications() {
    // Add notification badge to documents tab if there are pending signatures
    const pendingSignatures = document.querySelectorAll('.badge.bg-info');
    if (pendingSignatures.length > 0) {
        const documentosTab = document.getElementById('documentos-tab');
        if (documentosTab && !documentosTab.querySelector('.notification-badge')) {
            const badge = document.createElement('span');
            badge.className = 'badge bg-danger ms-2 notification-badge';
            badge.textContent = pendingSignatures.length;
            badge.title = `${pendingSignatures.length} documento(s) pendiente(s) de firma`;
            documentosTab.appendChild(badge);
        }
    }
    
    // Add notification badge to temas tab if user needs to add topics
    const needsTopics = document.querySelector('.btn-primary[href*="cargar_sorteos"]');
    if (needsTopics) {
        const temasTab = document.getElementById('temas-tab');
        if (temasTab && !temasTab.querySelector('.notification-badge')) {
            const badge = document.createElement('span');
            badge.className = 'badge bg-warning ms-2 notification-badge';
            badge.textContent = '!';
            badge.title = 'Necesita cargar temas para el sorteo';
            temasTab.appendChild(badge);
        }
    }
}
</script>
<script src="{{ url_for('static', filename='js/programas-auto.js') }}"></script>
{% endblock %}
